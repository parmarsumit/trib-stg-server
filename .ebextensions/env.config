files:
  "/usr/local/bin/mount-efs.sh":
    mode: "000755"
    owner: root
    group: root
    content : |
      #!/bin/bash
      sudo mkdir -p /media/share
      #sudo chmod -R 777 /media/share
      sudo echo fs-d1fda718':/ /media/share nfs4 nfsvers=4.1,rsize=1048576,wsize=1048576,hard,timeo=600,retrans=2 0 0' >> /etc/fstab
      sudo mount -a -t nfs4
      sudo mkdir -p /media/share   # add this step to create app directory
      sudo chmod -R 777 /media/share
      echo 'EFS mount complete.'

  "/etc/httpd/conf.d/proxy-pass.conf":
    mode: 000644
    owner: root
    group: root
    content: |
      ProxyPass /ws/ ws://127.0.0.1:9999/
      ProxyPassReverse /ws/ ws://127.0.0.1:9999/

  "/etc/httpd/conf.modules.d/99-mod_proxy_wstunnel.conf":
    mode: 000644
    owner: root
    group: root
    content: |
      <IfModule !proxy_wstunnel_module>
      LoadModule proxy_wstunnel_module modules/mod_proxy_wstunnel.so
      </IfModule>


container_commands:
  00_create_logs_directory:
    test: test ! -d /media/share
    command: mkdir -p /media/share && chown -R webapp:webapp /media/share && chmod 755 /media/share
    
  
  01_efs_mount_in_dev_devqa:
    command: "/usr/local/bin/mount-efs.sh"